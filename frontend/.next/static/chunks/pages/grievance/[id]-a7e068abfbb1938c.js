(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[550],{4483:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/grievance/[id]",function(){return t(6815)}])},6815:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return i}});var a=t(5893),r=t(7294),l=t(1163),d=t(9008),n=t.n(d),c=t(1664),m=t.n(c);function i(){let e=(0,l.useRouter)(),{id:s}=e.query,[t,d]=(0,r.useState)(null),[c,i]=(0,r.useState)(!0),[o,x]=(0,r.useState)(""),[h,g]=(0,r.useState)(""),[u,p]=(0,r.useState)([]);(0,r.useEffect)(()=>{if(!s)return;let t=localStorage.getItem("token");if(!t){e.push("/login");return}b(t,s)},[s,e]);let b=async(e,s)=>{try{i(!0);let t=await fetch("http://localhost:5000/api/grievances/".concat(s),{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();d(e),p(e.comments||[])}else{let e=await t.json();x(e.message||"Failed to fetch grievance details")}}catch(e){x("An error occurred while fetching the grievance")}finally{i(!1)}},y=async e=>{try{let a=localStorage.getItem("token"),r=await fetch("http://localhost:5000/api/grievances/".concat(s,"/status"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify({status:e})});if(r.ok){let s={...t,status:e};d(s)}else{let e=await r.json();x(e.message||"Failed to update status")}}catch(e){x("An error occurred while updating the status")}},j=async e=>{if(e.preventDefault(),h.trim())try{let e=localStorage.getItem("token"),t=await fetch("http://localhost:5000/api/grievances/".concat(s,"/comments"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({text:h})});if(t.ok){let e=await t.json();p([...u,e]),g("")}else{let e=await t.json();x(e.message||"Failed to add comment")}}catch(e){x("An error occurred while adding the comment")}};return c?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):o?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 flex flex-col items-center justify-center p-4",children:[(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded mb-4 max-w-md w-full",children:o}),(0,a.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded",onClick:()=>e.push("/dashboard"),children:"Back to Dashboard"})]}):t?(0,a.jsxs)("div",{children:[(0,a.jsx)(n(),{children:(0,a.jsxs)("title",{children:["Grievance #",t._id," - Grievance Redressal Portal"]})}),(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 py-8 px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsxs)("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[(0,a.jsx)(m(),{href:"/dashboard",className:"text-blue-600 mr-2 hover:text-blue-800",children:(0,a.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),"Grievance Details"]}),(0,a.jsx)("span",{className:"px-3 py-1 inline-flex text-sm leading-5 font-semibold rounded-full ".concat((e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"in-progress":return"bg-blue-100 text-blue-800";case"resolved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(t.status)),children:t.status.charAt(0).toUpperCase()+t.status.slice(1)})]}),(0,a.jsxs)("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg mb-6",children:[(0,a.jsxs)("div",{className:"px-4 py-5 sm:px-6",children:[(0,a.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:t.title}),(0,a.jsx)("p",{className:"mt-1 max-w-2xl text-sm text-gray-500",children:t.subject})]}),(0,a.jsx)("div",{className:"border-t border-gray-200",children:(0,a.jsxs)("dl",{children:[(0,a.jsxs)("div",{className:"bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Name"}),(0,a.jsx)("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:t.name})]}),(0,a.jsxs)("div",{className:"bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Email"}),(0,a.jsx)("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:t.email})]}),(0,a.jsxs)("div",{className:"bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"University Roll Number"}),(0,a.jsx)("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:t.universityRollNumber})]}),(0,a.jsxs)("div",{className:"bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Branch"}),(0,a.jsx)("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:t.branch})]}),(0,a.jsxs)("div",{className:"bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Year"}),(0,a.jsx)("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:t.year})]}),(0,a.jsxs)("div",{className:"bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Mobile Number"}),(0,a.jsx)("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:t.mobileNumber})]}),(0,a.jsxs)("div",{className:"bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Type"}),(0,a.jsx)("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:t.type})]}),(0,a.jsxs)("div",{className:"bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Description"}),(0,a.jsx)("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2 whitespace-pre-line",children:t.description})]}),(0,a.jsxs)("div",{className:"bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Created At"}),(0,a.jsx)("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:new Date(t.createdAt).toLocaleString()})]}),(0,a.jsxs)("div",{className:"bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Attachments"}),(0,a.jsx)("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:t.attachments&&t.attachments.length>0?(0,a.jsx)("ul",{className:"border border-gray-200 rounded-md divide-y divide-gray-200",children:t.attachments.map((e,s)=>(0,a.jsxs)("li",{className:"pl-3 pr-4 py-3 flex items-center justify-between text-sm",children:[(0,a.jsxs)("div",{className:"w-0 flex-1 flex items-center",children:[(0,a.jsx)("svg",{className:"flex-shrink-0 h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M8 4a3 3 0 00-3 3v4a5 5 0 0010 0V7a1 1 0 112 0v4a7 7 0 11-14 0V7a5 5 0 0110 0v4a3 3 0 11-6 0V7a1 1 0 012 0v4a1 1 0 102 0V7a3 3 0 00-3-3z",clipRule:"evenodd"})}),(0,a.jsx)("span",{className:"ml-2 flex-1 w-0 truncate",children:e.originalname||e})]}),(0,a.jsx)("div",{className:"ml-4 flex-shrink-0",children:(0,a.jsx)("a",{href:"http://localhost:5000/api/grievances/".concat(t._id,"/attachments/").concat(e.filename||e),download:!0,className:"font-medium text-blue-600 hover:text-blue-500",children:"Download"})})]},s))}):(0,a.jsx)("p",{children:"No attachments"})})]})]})})]}),"staff"===localStorage.getItem("userRole")&&(0,a.jsxs)("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg mb-6",children:[(0,a.jsx)("div",{className:"px-4 py-5 sm:px-6",children:(0,a.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Update Status"})}),(0,a.jsx)("div",{className:"border-t border-gray-200 px-4 py-5 sm:px-6",children:(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsx)("button",{onClick:()=>y("pending"),className:"px-4 py-2 rounded-md text-sm font-medium ".concat("pending"===t.status?"bg-yellow-200 text-yellow-800 cursor-default":"bg-yellow-100 text-yellow-800 hover:bg-yellow-200"),disabled:"pending"===t.status,children:"Pending"}),(0,a.jsx)("button",{onClick:()=>y("in-progress"),className:"px-4 py-2 rounded-md text-sm font-medium ".concat("in-progress"===t.status?"bg-blue-200 text-blue-800 cursor-default":"bg-blue-100 text-blue-800 hover:bg-blue-200"),disabled:"in-progress"===t.status,children:"In Progress"}),(0,a.jsx)("button",{onClick:()=>y("resolved"),className:"px-4 py-2 rounded-md text-sm font-medium ".concat("resolved"===t.status?"bg-green-200 text-green-800 cursor-default":"bg-green-100 text-green-800 hover:bg-green-200"),disabled:"resolved"===t.status,children:"Resolved"}),(0,a.jsx)("button",{onClick:()=>y("rejected"),className:"px-4 py-2 rounded-md text-sm font-medium ".concat("rejected"===t.status?"bg-red-200 text-red-800 cursor-default":"bg-red-100 text-red-800 hover:bg-red-200"),disabled:"rejected"===t.status,children:"Rejected"})]})})]}),(0,a.jsxs)("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:[(0,a.jsx)("div",{className:"px-4 py-5 sm:px-6",children:(0,a.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Comments"})}),(0,a.jsxs)("div",{className:"border-t border-gray-200 px-4 py-5 sm:px-6",children:[0===u.length?(0,a.jsx)("p",{className:"text-gray-500 text-sm",children:"No comments yet"}):(0,a.jsx)("ul",{className:"space-y-4",children:u.map((e,s)=>{var t;return(0,a.jsxs)("li",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-900",children:(null===(t=e.user)||void 0===t?void 0:t.name)||"User"}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:new Date(e.createdAt).toLocaleString()})]}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-700",children:e.text})]},s)})}),(0,a.jsxs)("form",{onSubmit:j,className:"mt-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"comment",className:"sr-only",children:"Add a comment"}),(0,a.jsx)("textarea",{id:"comment",rows:3,className:"shadow-sm block w-full focus:ring-blue-500 focus:border-blue-500 sm:text-sm border border-gray-300 rounded-md",placeholder:"Add a comment...",value:h,onChange:e=>g(e.target.value)})]}),(0,a.jsx)("div",{className:"mt-3 flex justify-end",children:(0,a.jsx)("button",{type:"submit",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Add Comment"})})]})]})]})]})})]}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 flex flex-col items-center justify-center p-4",children:[(0,a.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 text-yellow-600 px-4 py-3 rounded mb-4 max-w-md w-full",children:"Grievance not found"}),(0,a.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded",onClick:()=>e.push("/dashboard"),children:"Back to Dashboard"})]})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=4483)}),_N_E=e.O()}]);